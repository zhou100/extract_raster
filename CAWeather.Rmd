---
title: "CA Weather"
author: "Yujun Zhou"
date: "May 2, 2018"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.width=40, fig.height=40) 

```

```{r,include=FALSE}
library(ggplot2) #Calls: fortify, ggplot
library(rgdal)   
library(sp)      
library(raster)
library(gdalUtils)
library(parallel)
library(RCurl)
library(R.utils)
library(rgeos)
library(dplyr)
```


```{r,include=FALSE}
zmw_ward=readOGR("shapefiles/zmw/zwe_polbnda_adm3_250k_cso.shp")
```

```{r}
plot(zmw_ward)
```


## Daily temperature (min and max) for each ward (1970/01/01- 2018/04/28) 

Dataset extracted from African Drought Monitor (using extract_afm.R), see temp_min.csv and temp_max.csv 

```{r,include=FALSE}
tmax0918 = read.csv("D:/zmw_daily_tmax09_18.csv")
rlist <- list.files(path="D:/zmw_temp/tmax--GFS_ANALYSIS_BC", 
                    pattern = "asc$",
                    full.names=TRUE)
#name_list<-gsub(pattern = "D:/zmw_temp/tmin--GFS_ANALYSIS_BC/",x=rlist,replacement = "")
name_list<-gsub(pattern = "D:/zmw_temp/tmax--GFS_ANALYSIS_BC/",x=rlist,replacement = "")

#name_list<- gsub(pattern = "_GFS_ANALYSIS_BC_",x=name_list,replacement = "")

name_list<- gsub(pattern = "_GFS_ANALYSIS_BC_",x=name_list,replacement = "")

name_list<- gsub(pattern = "tmax",x=name_list,replacement = "")
name_list<- gsub(pattern = "_daily.asc",x=name_list,replacement = "")

date1 = as.Date(name_list,"%Y%m%d")
date1 = format(date1, "%m/%d/%Y")
tmax0918$date1 = date1
```

```{r,include=FALSE}
tmin0918 = read.csv("D:/zmw_daily_tmin09_18.csv")
rlist <- list.files(path="D:/zmw_temp/tmin_GFS_ANALYSIS_BC", 
                    pattern = "asc$",
                    full.names=TRUE)
#name_list<-gsub(pattern = "D:/zmw_temp/tmin--GFS_ANALYSIS_BC/",x=rlist,replacement = "")
name_list<-gsub(pattern = "D:/zmw_temp/tmin_GFS_ANALYSIS_BC/",x=rlist,replacement = "")

#name_list<- gsub(pattern = "_GFS_ANALYSIS_BC_",x=name_list,replacement = "")

name_list<- gsub(pattern = "_GFS_ANALYSIS_BC_",x=name_list,replacement = "")

name_list<- gsub(pattern = "tmin",x=name_list,replacement = "")
name_list<- gsub(pattern = "_daily.asc",x=name_list,replacement = "")

date1 = as.Date(name_list,"%Y%m%d")
date1 = format(date1, "%m/%d/%Y")
tmin0918$date1 = date1
```


```{r,include=FALSE}
tmax7008 = read.csv("D:/zmw_daily_tmax70_08.csv")
rlist <- list.files(path="D:/zmw_temp/tmax--PGF", 
                    pattern = "asc$",
                    full.names=TRUE)
#name_list<-gsub(pattern = "D:/zmw_temp/tmin--GFS_ANALYSIS_BC/",x=rlist,replacement = "")
name_list<-gsub(pattern = "D:/zmw_temp/tmax--PGF/",x=rlist,replacement = "")

#name_list<- gsub(pattern = "_GFS_ANALYSIS_BC_",x=name_list,replacement = "")

name_list<- gsub(pattern = "_PGF_",x=name_list,replacement = "")

name_list<- gsub(pattern = "tmax",x=name_list,replacement = "")
name_list<- gsub(pattern = "_daily.asc",x=name_list,replacement = "")

date1 = as.Date(name_list,"%Y%m%d")
date1 = format(date1, "%m/%d/%Y")
tmax7008$date1 = date1
```

```{r,include=FALSE}

tmin7008 = read.csv("D:/zmw_daily_tmin70_08.csv")
rlist <- list.files(path="D:/zmw_temp/tmin--PGF", 
                    pattern = "asc$",
                    full.names=TRUE)
#name_list<-gsub(pattern = "D:/zmw_temp/tmin--GFS_ANALYSIS_BC/",x=rlist,replacement = "")
name_list<-gsub(pattern = "D:/zmw_temp/tmin--PGF/",x=rlist,replacement = "")

#name_list<- gsub(pattern = "_GFS_ANALYSIS_BC_",x=name_list,replacement = "")

name_list<- gsub(pattern = "_PGF_",x=name_list,replacement = "")

name_list<- gsub(pattern = "tmin",x=name_list,replacement = "")
name_list<- gsub(pattern = "_daily.asc",x=name_list,replacement = "")

date1 = as.Date(name_list,"%Y%m%d")
date1 = format(date1, "%m/%d/%Y")
tmin7008$date1 = date1

```


```{r,include=FALSE}

# combine different years 
tmin_zmw = dplyr::bind_rows(tmin7008,tmin0918)
tmax_zmw = dplyr::bind_rows(tmax7008,tmax0918)

# write them into csv file

write.csv(tmin_zmw, "D:/temp_min.csv")
write.csv(tmax_zmw, "D:/temp_max.csv")

```

## Daily rainfall for each ward (1981/01/01- 2018/04/28) 

Dataset extracted from CHIRPS (using daily_rain_zmw.R), see daily_rain.csv   

```{r,include=FALSE}
rain07 = read.csv("D:/zmw_daily_rain07.csv")


rain0818 = read.csv("D:/zmw_daily_rain08_18.csv")
raindate = read.csv("D:/datechirps.csv")
rain0818$date1 = raindate$date1

rain0718 = dplyr::bind_rows(rain07,rain0818)
write.csv(rain0718,"D:/daily_rain.csv")

```

## Daily temperatures for each ward for the growing season (October to June) starting in October 2007 and ending in June 2011.

see growseason_temp_min.csv and growseason_temp_max.csv 


```{r,include=FALSE} 
# limit to the given time frame 

tmin_zmw$date1= as.Date(tmin_zmw$date1,"%m/%d/%Y")
tmin0708 = tmin_zmw %>% dplyr::filter(date1>"2007-10-01" & date1<"2008-07-01") 
tmin0809 = tmin_zmw %>% dplyr::filter(date1>"2008-10-01" & date1<"2009-07-01") 
tmin0910 = tmin_zmw %>% dplyr::filter(date1>"2009-10-01" & date1<"2010-07-01") 
tmin1011 = tmin_zmw %>% dplyr::filter(date1>"2010-10-01" & date1<"2011-07-01") 


tmax_zmw$date1= as.Date(tmax_zmw$date1,"%m/%d/%Y")
tmax0708 = tmax_zmw %>% dplyr::filter(date1>"2007-10-01" & date1<"2008-07-01") 
tmax0809 = tmax_zmw %>% dplyr::filter(date1>"2008-10-01" & date1<"2009-07-01") 
tmax0910 = tmax_zmw %>% dplyr::filter(date1>"2009-10-01" & date1<"2010-07-01") 
tmax1011 = tmax_zmw %>% dplyr::filter(date1>"2010-10-01" & date1<"2011-07-01") 

growseason_temp_min = dplyr::bind_rows(tmin0708,tmin0809,tmin0910,tmin1011)
growseason_temp_max = dplyr::bind_rows(tmax0708,tmax0809,tmax0910,tmax1011)

write.csv(growseason_temp_min,"D:/growseason_temp_min.csv")
write.csv(growseason_temp_max,"D:/growseason_temp_max.csv")

```




## 4 Rainfall Maps (CHIRPS daily rainfall data for the entire country, calculate cumulative seasonal rainfall )

a.       October 2007 – June 2008
b.       October 2008 – June 2009
c.       October 2009 – June 2010
d.       October 201 – June 2011

```{r,include=FALSE}
 
rain0818$date1= as.Date(rain0818$date1,"%m/%d/%Y")
rain0818 = rain0818 %>% select(-X)
rain0708 = rain0818 %>% dplyr::filter(date1>"2007-10-01" & date1<"2008-07-01") 
rain0809 = rain0818 %>% dplyr::filter(date1>"2008-10-01" & date1<"2009-07-01") 
rain0910 = rain0818 %>% dplyr::filter(date1>"2009-10-01" & date1<"2010-07-01") 
rain1011 = rain0818 %>% dplyr::filter(date1>"2010-10-01" & date1<"2011-07-01") 

rain0708$date1
```

create a “heat” map for cumulative season rainfall, lay over the outlines of the surveyed wards on the “heat” map.


## 4 Temperature Maps (Gdd and mean temperature)

create a “heat” map for cumulative season rainfall, lay over the outlines of the surveyed wards on the “heat” map.



 